---
/**
 * RecipeStep.astro
 * Ett steg i oppskriften – blå avhuking, hvit boks,
 * første linje beholdes synlig ved avhuking.
 *
 * Props:
 *  - text: hovedtekst (vises alltid)
 *  - altText: alternativ/forklarende tekst (valgfri)
 *
 * Bruk:
 * <RecipeStep text="Pisk egg og melk sammen" altText="bruk gjerne romtempererte egg" />
 */
const { text, altText } = Astro.props;
---

<div class="recipe-step">
  <label class="step-box">
    <input type="checkbox" class="circle" />
    <p class="text">
      {altText && <span class="alt-text"> {altText}</span>}
      {text}
    </p>
  </label>
</div>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    const checkboxes = document.querySelectorAll(".circle");
    checkboxes.forEach((cb, i) => {
      const key = `recipe-step-${i}`;
      cb.checked = localStorage.getItem(key) === "true";
      cb.addEventListener("change", () => {
        localStorage.setItem(key, cb.checked);
      });
    });
  });
</script>


<style>
.recipe-step {
  margin: 1rem 0;
}

/* === Kortboks === */
.step-box {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  background: #fff;
  border: 1px solid #000;
  border-radius: 0.75rem;
  padding: 0.75rem 1rem;
  cursor: pointer;
  overflow: hidden;
  transition: background 0.3s ease, opacity 0.3s ease, max-height 0.4s ease;
}

/* === Avhukingsboks === */
input.circle {
  appearance: none;
  width: 1.2rem;
  height: 1.2rem;
  border: 2px solid #0070f3;
  border-radius: 50%;
  background: #fff;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
  margin-top: 0.3rem;
  transition: background 0.2s ease, border-color 0.2s ease;
}

input.circle:checked {
  background: #0070f3;
  border-color: #0070f3;
}

input.circle:checked::after {
  content: "";
  position: absolute;
  inset: 0.3rem;
  border-radius: 50%;
  background: #fff;
}

/* === Tekst === */
.text {
  margin: 0;
  flex: 1;
  font-size: 1rem;
  line-height: 1.4;
  color: #000;
  transition: color 0.3s ease, opacity 0.3s ease, max-height 0.4s ease;
}

/* Alternativ tekst (fet, samme linje) */
.alt-text {
  font-weight: 600;
  color: #000;
}

/* === Når avkrysset === */
input.circle:checked ~ .text {
  color: #555;
  text-decoration: line-through;
  opacity: 0.7;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

/* Hindrer tekstmarkering */
p, span {
  user-select: none;
}
</style>
