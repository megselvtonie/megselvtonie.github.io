---
/**
 * RecipeStep.astro
 * Ett steg i oppskriften – blå avhuking, hvit boks,
 * første linje beholdes synlig ved avhuking.
 *
 * Props:
 *  - text: hovedtekst (vises alltid)
 *  - altText: alternativ/forklarende tekst (valgfri)
 *
 * Bruk:
 * <RecipeStep text="Pisk egg og melk sammen" altText="bruk gjerne romtempererte egg" />
 */
const { text, altText, image } = Astro.props;
---

<div class="recipe-step">
  <label class="step-box">
    <input type="checkbox" class="circle" />
    <p class="text">
      {altText && <span class="alt-text"> {altText}</span>}
      {text}
       {image && <img src={image} alt="" class="step-image" />}
    </p>
  </label>
</div>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    const checkboxes = document.querySelectorAll(".circle");
    checkboxes.forEach((cb, i) => {
      const key = `recipe-step-${i}`;
      cb.checked = localStorage.getItem(key) === "true";
      cb.addEventListener("change", () => {
        localStorage.setItem(key, cb.checked);
      });
    });
  });
</script>


<style>
.recipe-step {
  margin: 1rem 0;
}

/* === Kortboks === */
/* Dette er containeren rundt hvert steg i oppskriften (checkbox + tekst). */
.step-box {
  display: flex;                 /* Legger elementene inni (checkbox og tekst) ved siden av hverandre på samme linje. */
  align-items: flex-start;       /* Justerer innholdet mot toppen i stedet for midten, slik at tekst starter på samme linje som sirkelen. */
  gap: 0.75rem;                  /* Lager mellomrom mellom checkboxen og teksten (0.75rem ≈ 12px). */

  background: #ffffff;              /* Gir hvit bakgrunn på boksen. */
  border: 1px solid #000;        /* Sort ramme rundt hele boksen. */
  border-radius: 0.75rem;        /* Gjør hjørnene avrundet (12px avrunding). */

  padding: 0.75rem 1rem;         /* Innvendig luft: 0.75rem oppe/nede og 1rem på sidene. */
  cursor: pointer;               /* Gjør at musa får "klikke-hånd" når man holder over boksen. */
  overflow: hidden;              /* Skjuler innhold som stikker utenfor rammen (nyttig ved animasjoner). */

  /* Overgangsanimasjon som gjør at endringer (f.eks. avkrysset/ikke avkrysset) ser mykere ut */
  transition: 
    background 0.3s ease,        /* Farger endres gradvis over 0.3 sekunder. */
    opacity 0.3s ease,           /* Gjennomsiktighet endres mykt. */
    max-height 0.4s ease;        /* Når boksen ekspanderer eller kollapser, skjer det med en animasjon. */
}


/* === Avhukingsboks === */
input.circle {
  appearance: none;
  width: 1.2rem;
  height: 1.2rem;
  border: 2px solid #0070f3;
  border-radius: 50%;
  background: #fff;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
  margin-top: 0.1rem;
}

input.circle:checked {
  background: #0070f3;
  border-color: #0070f3;
}

input.circle:checked::after {
  content: "";
  position: absolute;
  inset: 0.3rem;
  border-radius: 50%;
  background: #fff;
}

/* === Tekst === */
.text {
  margin: 0;
  flex: 1;
  font-size: 1rem;
  line-height: 1.4;
  color: #000;
  transition: color 0.3s ease, opacity 0.3s ease, max-height 0.4s ease;
}

/* Alternativ tekst (fet, samme linje) */
.alt-text {
  font-weight: 600;
  color: #000;
}

/* === Når avkrysset === */
input.circle:checked ~ .text {
  color: #555;
  text-decoration: line-through;
  opacity: 0.7;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

/* Hindrer tekstmarkering */
p, span {
  user-select: none;
}
</style>
