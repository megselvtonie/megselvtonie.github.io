---
/* PageView.astro */
import "../styles/global.css";
import DateTag from "./DateTag.astro";
---

<div class="pageview">
  <p>
    NYESTE NYTT GUTTAAA! <br />
    <DateTag datetime="2025-09-07T19:06" />
  </p>
  <p>
    <strong>
      OMG, jeg er sååå stolt av denne:
      Du, jeg og andre har nemlig klikket på siden min →
      <span id="today-count" class="badge">…</span>
      ganger i dag.
    </strong>
  </p>
  <p>
    Totalt har siden blitt besøkt →
    <span id="total-count" class="badge">…</span>
    ganger siden <time datetime="2025-09-07T18:28">7. september kl. 18.28</time>.
  </p>

  <p class="note">
    <small>
      NB! Det er mest meg selv som tester og klikker opp til 100 ganger i timen.
    </small>
  </p>
</div>

<script is:inline>
  async function loadCounter() {
    const todayEl = document.getElementById("today-count");
    const totalEl = document.getElementById("total-count");

    try {
      const res = await fetch("https://hitscounter.dev/api/hit?output=json&url=megselvtonie.me");
      if (!res.ok) throw new Error("HTTP-feil " + res.status);
      const json = await res.json();

      todayEl.textContent = json.today_hits ?? "0";
      totalEl.textContent = json.total_hits ?? "0";
    } catch (err) {
      todayEl.textContent = ":'c";
      totalEl.textContent = ":'c";
      console.error("Har en feil her :c:", err);
    }
  }

  loadCounter();
</script>

<style>
  .pageview {
    font-size: 0.8rem;
    line-height: 1.5;
    padding: 0.5rem;
    border: 1px solid #000;
    border-radius: 0.25rem;
    margin: 1rem 0;
  }

  .badge {
    display: inline-block;
    padding: 0.1rem 0.4rem;
    margin: 0 0.2rem;
    border: 1px solid currentColor;
    border-radius: 0.25rem;
    font-size: 0.8rem;
    font-weight: 600;
    font-style: italic;
    color: #000;
  }

  .note {
    margin-top: 0.5rem;
    color: #333;
  }
</style>
