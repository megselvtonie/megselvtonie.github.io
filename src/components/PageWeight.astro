---
---
<div id="page-weight" aria-live="polite">Måler sidevekt…</div>

<script is:inline>
// @ts-nocheck  — hold dette skriptet i ren JS for å unngå TS-støy i inline-script
(() => {
  const el = document.getElementById('page-weight');
  if (!el) return;

  const toKB = (b) => Math.max(0, Math.round(b / 1024));

  // Hent “beste” tilgjengelige størrelse for en entry.
  // Prioritet: encodedBodySize (komprimert) → transferSize (inkl. headere; 0 ved cache) → decodedBodySize (ukomprimert).
  const sizeOf = (entry) => {
    if (!entry) return 0;
    const a = (typeof entry.encodedBodySize === 'number' && entry.encodedBodySize > 0) ? entry.encodedBodySize : 0;
    const b = (typeof entry.transferSize    === 'number' && entry.transferSize    > 0) ? entry.transferSize    : 0;
    const c = (typeof entry.decodedBodySize === 'number' && entry.decodedBodySize > 0) ? entry.decodedBodySize : 0;
    return a || b || c || 0;
  };

  function compute() {
    let htmlBytes = 0;
    let totalBytes = 0;

    // HTML-dokumentet (navigation entry)
    const nav = performance.getEntriesByType('navigation')[0];
    if (nav) {
      const n = sizeOf(nav);
      htmlBytes = n;
      totalBytes += n;
    }

    // Øvrige ressurser (CSS, JS, bilder, fonter, osv.)
    const res = performance.getEntriesByType('resource');
    for (const r of res) totalBytes += sizeOf(r);

    const files = (nav ? 1 : 0) + res.length;

    el.textContent =
      `Sidevekt: ${toKB(totalBytes)} KB ` +
      `(HTML: ${toKB(htmlBytes)} KB) • Filer: ${files}`;
  }

  // Første måling
  if (document.readyState === 'complete') compute();
  else addEventListener('load', compute);

  // Oppdater når nye/lazy ressurser dukker opp
  if ('PerformanceObserver' in window) {
    try {
      const po = new PerformanceObserver(() => compute());
      po.observe({ type: 'resource', buffered: true });
      po.observe({ type: 'navigation', buffered: true });
    } catch {
      /* noen nettlesere støtter ikke alle typene – try/catch er ok */
    }
  }
})();
</script>

<style>
  #page-weight {
    margin-top: 1rem;
    font: 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color: red;
  }
</style>
